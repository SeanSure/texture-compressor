<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Texture handler</title>
	<style>
		body, html {
			font-family: Arial, Helvetica, sans-serif;
			margin: 0;
			padding: 0;
			width: 100%;
			height: 100%;
			background: #fefefe;
		}

		#app {
			padding-left: 25px;
		}

		canvas {
			margin: 10px 0 20px 0;
			padding: 0px;
			border: 1px solid red;
			display: block;
		}
	</style>
</head>
<body>
    <div id="app">
		<h1>Texture handler</h1>
		<section class="astc">
			<h3>ASTC</h3>
			<div class="gallery-item" id="ASTC_RGBA_4x4">ASTC 4x4 (RGBA)</div>
			<div class="gallery-item" id="ASTC_RGBA_5x4">ASTC 5x4 (RGBA)</div>
			<div class="gallery-item" id="ASTC_RGBA_5x5">ASTC 5x5 (RGBA)</div>
			<div class="gallery-item" id="ASTC_RGBA_6x5">ASTC 6x5 (RGBA)</div>
			<div class="gallery-item" id="ASTC_RGBA_6x6">ASTC 6x6 (RGBA)</div>
			<div class="gallery-item" id="ASTC_RGBA_8x5">ASTC 8x5 (RGBA)</div>
			<div class="gallery-item" id="ASTC_RGBA_8x6">ASTC 8x6 (RGBA)</div>
			<div class="gallery-item" id="ASTC_RGBA_8x8">ASTC 8x8 (RGBA)</div>
			<div class="gallery-item" id="ASTC_RGBA_10x5">ASTC 10x5 (RGBA)</div>
			<div class="gallery-item" id="ASTC_RGBA_10x6">ASTC 10x6 (RGBA)</div>
			<div class="gallery-item" id="ASTC_RGBA_10x8">ASTC 10x8 (RGBA)</div>
			<div class="gallery-item" id="ASTC_RGBA_10x10">ASTC 10x10 (RGBA)</div>
			<div class="gallery-item" id="ASTC_RGBA_12x10">ASTC 12x10 (RGBA)</div>
			<div class="gallery-item" id="ASTC_RGBA_12x12">ASTC 12x12 (RGBA)</div>
		</section>

		<section class="s3tc">
			<h3>S3TC</h3>
			<div class="gallery-item" id="DXT1_RGB">DXT1 (RGBA)</div>
			<div class="gallery-item" id="DXT1_RGBA">DXT1 (RGBA)</div>
			<div class="gallery-item" id="DXT3_RGBA">DXT3 (RGBA)</div>
			<div class="gallery-item" id="DXT5_RGBA">DXT5 (RGBA)</div>
		</section>

		<section class="etc1">
			<h3>ETC1</h3>
			<div class="gallery-item" id="ETC1_RGB">ETC1 (RGB)</div>
		</section>

		<section class="etc2">
			<h3>ETC2</h3>
			<div class="gallery-item" id="ETC2_RGB">ETC2 (RGB)</div>
			<div class="gallery-item" id="ETC2_RGBA">ETC2 (RGBA)</div>
		</section>

		<section class="pvrtc">
			<h3>PVRTC</h3>
			<div class="gallery-item" id="PVRTC_RGB_2BPP">PVRTC 2BPP (RGB)</div>
			<div class="gallery-item" id="PVRTC_RGBA_2BPP">PVRTC 2BPP (RGBA)</div>
			<div class="gallery-item" id="PVRTC_RGB_4BPP">PVRTC 4BPP (RGB)</div>
			<div class="gallery-item" id="PVRTC_RGBA_4BPP">PVRTC 4BPP (RGBA)</div>
		</section>
	</div>

	<script src="./fileLoader.js"></script>
	<script src="./parseKTX.js"></script>
	<script src="./parseBinary.js"></script>
	<script src="./loadBinary.js"></script>
	<script src="./webGLUtilities.js"></script>
    <script>
		// Initialize
		// ----------
		function initialize() {
			const app = document.getElementById('app');

			const result = Promise.all([
				loadBinary('./../example/example-astc.ktx'),
				loadBinary('./../example/example-dxt1.ktx'),
				loadBinary('./../example/example-dxt3.ktx'),
				loadBinary('./../example/example-dxt5.ktx'),
				loadBinary('./../example/example-etc1.ktx'),
				loadBinary('./../example/example-etc2.ktx'),
				loadBinary('./../example/example-pvrtc1.ktx'),
			]);

			const pixelRatio = window.devicePixelRatio;

			result
				.then((data) => {
					data.map((file) => {
						const element = document.getElementById(`${file.id}`);
						const canvas = document.createElement('canvas');
						const gl = canvas.getContext('webgl');

						canvas.width = file.width * pixelRatio;
						canvas.height = file.height * pixelRatio;
						canvas.style.width = `${file.width}px`;
						canvas.style.height = `${file.height}px`;

						gl.enable(gl.SCISSOR_TEST);
						gl.viewport(0, 0, file.width * pixelRatio, file.height * pixelRatio);
						gl.scissor(0, 0, file.width * pixelRatio, file.height * pixelRatio);

						// Get extension to match file
						const extension =
							gl.getExtension(`WEBGL_compressed_texture_${file.compression}`) ||
							gl.getExtension(`WEBKIT_WEBGL_compressed_texture_${file.compression}`) ||
							gl.getExtension(`MOZ_WEBGL_compressed_texture_${file.compression}`);

						if (extension) {
							element.appendChild(canvas);
							createImage(gl, file);
						} else {
							console.log(`WEBGL_compressed_texture_${file.compression} extension is not available - ${file.format}`);
						}
					});
				});
		}

		initialize();
    </script>
</body>
</html>
